#! /usr/bin/env ruby

require 'haml'
require 'redcarpet'

require './entry'

filenames = Dir['entries/**/*.md']

template = File.read('template.haml')
haml_engine = Haml::Engine.new(template, { ugly: true })
markdown = Redcarpet::Markdown.new(Redcarpet::Render::HTML, fenced_code_blocks: true)

build_time = Time.now.strftime("%m/%d/%Y %I:%M:%S %p")
output = haml_engine.render(Object.new, { entry_count: filenames.count, build_time: build_time }) do
  filenames.map { |filename| Entry.new(filename, markdown).to_html }.join
end

File.open('output.html', 'w') do |file|
  file.puts output
end
