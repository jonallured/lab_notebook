#!/bin/bash

set -e

ooo_path=$1
person=$(echo $ooo_path | cut -d '/' -f4)
date=$(echo $ooo_path | cut -d '/' -f5 | cut -d '.' -f1)

id=$(bundle exec rake next_note_id)
title=$(ruby -r humanize -e "puts $id.humanize" | titlecase)

output=$(bundle exec middleman article "$title" --date="$date" --tags=one-on-one,$person)
article_path=$(echo $output | tr -s ' ' | cut -d ' ' -f2)

sed -i '' "s/ID/$id/" $article_path
cat $ooo_path >> $article_path
echo $article_path
