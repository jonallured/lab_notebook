#! /usr/bin/env ruby

require 'fileutils'
require './entry_decrypter'

key_paths = Dir['private_keys/*.key']
rsa_keys = key_paths.map { |path| OpenSSL::PKey::RSA.new(File.read(path)) }

filename = ARGV.first
encryption_json = File.read filename
encryption_details = JSON.parse encryption_json

decrypter = EntryDecrypter.new encryption_details, rsa_keys
decrypter.decrypt

FileUtils.mkdir_p(File.dirname(decrypter.filename))
File.open(decrypter.filename, 'w') { |f| f.puts decrypter.text }

puts decrypter.filename
