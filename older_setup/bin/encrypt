#! /usr/bin/env ruby

require 'fileutils'
require './entry_encrypter'

FileUtils.mkdir_p 'tmp'

filename = ARGV.first
text = File.read(filename)

unencrypted_details = {
  filename: filename,
  text: text
}

private_key = File.read 'private_keys/mine.link'
rsa_key = OpenSSL::PKey::RSA.new private_key

encrypter = EntryEncrypter.new unencrypted_details, rsa_key
encrypter.encrypt

tmp_path = File.join Dir.pwd, 'tmp', encrypter.filename

File.open(tmp_path, 'w') do |f|
  f.puts encrypter.text
end

puts tmp_path
